/**!
 * Jinn -- Notifications center
 * https://github.com/RubaXa/Jinn#readme
 *
 * @author	RubaXa	<trash@rubaxa.org>
 * @build	Jinn.OS, Jinn.bubble
 * @example
 * 	Jinn
 * 		.bubble(10)
 * 		.say({ icon: '..', title: '...', text: '...' })
 * 		.scope('menu')
 * 			.bubble(5)
 * 			.say({ ... })
 * 		.store('key', '...') // set
 * 	;
 *
 * 	var val = Jinn.store('key'); // get
 * 	Jinn.store('key', null); // remove
 */
(function(){var n=null;
(function(o,f,h){function l(){var a,c,b;for(a in m){c=d.store("__event."+a);for(b=m[a].length;b--;)m[a][b](c)}p=0}function r(){p||(p=1,clearTimeout(s),s=setTimeout(l,10))}function g(){}function k(){}var f=navigator.userAgent.toLowerCase(),b={scope:"OS"},t={},m={},s,p;g.ext=function(a){function c(){this.__lego.apply(this,arguments)}var b;k.prototype=this.fn;c.prototype=c.fn=new k;c.ext=g.ext;c.methods=g.methods;for(b in a)c.fn[b]=a[b];return c};g.methods=function(a){for(var c in a)this.fn[c]=a[c];
return this};g.prototype=g.fn={ALLOWED:0,NOT_ALLOWED:1,DENIED:2,_opts:{},__lego:k,_check:function(){return this.ALLOWED},_request:function(a){a()},_ext:function(a){for(var c in this._opts)a[c]===h&&(a[c]=this._opts[c]);return a},opt:function(a,c){var b=this;if(c!==h)b._opts[a]=c;else if("object"==typeof a)for(c in a)b._opts[c]=a[c];else b=b._opts[a];return b},access:function(a){if(a){if(!a.c){var c=this;a.c=function(){a.call(c)}}this.hasRight()?a.c():this._request(a.c)}else return this._check()},
hasRight:function(){return this.access()==this.ALLOWED},add:k,say:function(){return this.add.apply(this,arguments)},bubble:function(){},end:function(){return d}};var d={API:g,opt:function(a,c){if(c===h)return b[a];b[a]=c;return d},on:function(a,c){m[a]||(m[a]=[]);m[a].push(c);return d},off:function(a,c){if(a in m)for(var b=m[a],e=b.length;e--;)if(b[e]===c){b.splice(e,1);break}return d},emit:function(a,b){d.store("__event."+a,b);r()},scope:function(a,c){var j=d;if(a==h)j=d.scope(b.scope);else if(c!==
h)t[a]=c;else if(a in t)j=t[a];else throw'Jinn: scope "'+a+'" is undefined';return j},e:function(a,b,j){if(a){var e=a.addEventListener?"":"on";a[e?"attachEvent":"addEventListener"](e+b,j,!1)}return d}},i=["access","bubble","add","say"],q=i.length;for(;q--;)(function(a){d[a]=function(){var b=d.scope(),j=b[a].apply(b,arguments);return j===b?d:j}})(i[q]);d.store=function(a,b){var j=d,e=d.scope("__store");b===n?e.remove("__jinn."+a):b===h?j=e.get("__jinn."+a):e.set("__jinn."+a,b);return j};(function(a,
b){d.scope("__store",{get:function(d){return a?a.getItem(d):b[d]},set:function(d,e){a?a.setItem(d,e):b[d]=e},remove:function(d){delete b[d];a&&a.removeItem(d)}})})(o.localStorage,{});d[(f.match(/webkit/)||f.match(/opera/)||f.match(/msie/)||0>f.indexOf("compatible")&&f.match(/mozilla/)||[])[0]]=!0;d.webkit&&(d[(f.match(/chrome/)||f.match(/safari/)||[])[0]]=!0);d.e(o,"storage",r);o.Jinn=d})(window,document);
(function(o,f,h,l){o=h.API.ext({_tpl:"#JinnOSTpl",_opts:{title:"",text:""},tpl:function(b){this._tpl=b;return this},add:function(b){"string"==typeof b&&(b={title:b});this._ext(b);var g=this._create(b);g.show();b.delay&&setTimeout(function(){g.cancel()},1E3*b.delay);return g}});if(l)o.methods({_check:function(){return l.checkPermission()},_request:function(b){l.requestPermission(b)},_create:function(b){return l.createNotification(b.icon,b.title,b.text)}});else{var r=/\{\{(.*?)\}\}/g,g=[],k=function(b,
g){this.a=f.createElement("div");this.a.innerHTML=("#"==b.charAt(0)?f.getElementById(b.substr(1)).innerHTML:b).replace(r,function(b,f){return(new Function("notify,v,u","try{v="+f+'}catch(e){} return v===u?"":v'))(g)});f.body.appendChild(this.a)};k.d=function(){for(var b=5,f=0,h=g.length;f<h;f++)g[f].a.style.top=b+"px",b+=g[f].a.offsetHeight+5};k.prototype={show:function(){if(this.a){g.push(this);var b=this.a.style;b.right="5px";b.position="fixed";b.display="block";k.d()}},cancel:function(){if(this.a){for(var b=
0,f=g.length;b<f;b++)g[b]===this&&(g.splice(b,1),k.d());this.a.parentNode.removeChild(this.a);this.a=n}}};o.methods({hasRight:function(){return!!this._tpl},_create:function(b){return new k(this._tpl,b)}})}h.scope("OS",new (h.OS=o))})(window,document,Jinn,window.webkitNotifications);
(function(o,f,h,l){function r(b){if(j&&(i.src!=a.src||d!=b))if(e.b(),c.width=c.height=16,i.src=a.src,i.onload=function(){function d(){var e=c.getContext("2d");e.clearRect(0,0,16,16);e.drawImage(i,0,0,i.width,i.height,a.iconX,a.iconY,a.iconW,a.iconH);a.shape(e,b,q,a);g(c.toDataURL());a.fps<=++q&&(q=0)}clearInterval(s);b===n||b===l||!a.fps?q=0:s=setInterval(d,~~(1E3/a.fps+0.5));b===n||b===l?g(a.src):d()},m.test(i.src)?(i.crossOrigin=n,i.removeAttribute("crossOrigin")):i.crossOrigin="anonymous",i.width)i.onload()}
function g(a){e.b();k(function(a){a.parentNode.removeChild(a)});var b=f.createElement("link");b.rel="icon";b.type="image/png";b.href=a;f.getElementsByTagName("head")[0].appendChild(b)}function k(a){for(var b=f.getElementsByTagName("link"),c=b.length;c--;)if(t.test(b[c].getAttribute("rel"))&&!0===a(b[c]))return b[c]}function b(){}var t=/\bicon\b/,m=/^data/,s,p,d=n,i=new Image,q=0,a={val:d,fps:2,iconX:0,iconY:0,iconW:16,iconH:16},c=f.createElement("canvas"),j=c.getContext&&!!~c.toDataURL("image/png").indexOf("data:image/png");
a.shape=function(a,b,c){var d=15.5,b=99<b?(d+=0.5,"99+"):b;a.font=(h.g?"bold ":"")+"9px arial";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=2;a.shadowColor="rgba(0,0,0,.5)";a.fillStyle=c?"#fc3":"#fff";a.textAlign="right";a.fillText(b,d,15);a.fillText(b,d,15);a.fillText(b,d,15)};var e={b:function(){e.b=b;e.f=1;var c=k(function(){return!0});c&&(p=c.href,e.opt("src",a.src||p))},src:function(a){return e.opt("src",a)},shape:function(a){e.opt("shape",a);return this},opt:function(b,c){var f=e.f||a.val||
"shape"==b;if("string"==typeof b){if(c===l)return a[b];a[b]=c}else for(var g in b)a[g]=b[g],f=f||"shape"==g;c=a.val;f&&r(c);c!==d&&h.emit("bubble:val",c);d=c},set:function(a){e.b();e.opt("val",a)},revert:function(){e.opt("src",p)},reset:function(){e.opt({src:p,val:n})},clear:function(){e.opt("val",n)}};h.OS.Bubble=e;h.scope("OS").bubble=function(a,b){if("object"==typeof a&&a!==n)e.opt(a);else if(a in e)e[a](b);else e.set(a);return h};h.on("bubble:val",function(a){e.set(a)})})(window,document,Jinn);
window.ajs&&ajs.loaded&&ajs.loaded("{Jinn}Jinn.min");"function"===typeof define&&define.amd&&define("Jinn",[],function(){return window.Jinn||{}});
})()